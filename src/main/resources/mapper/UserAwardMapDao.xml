<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hytc.o2o.dao.UserAwardMapDao">

    <resultMap id="userAndAwardMap" type="com.hytc.o2o.entity.UserAndAwardMap">
        <id column="user_award_id" property="userAndAwardId"></id>
        <result column="create_time" property="createTime"></result>
        <result column="point" property="point"></result>
        <result column="used_status" property="usedStatus"></result>
        <association property="user" javaType="com.hytc.o2o.entity.PersonInfo">
            <id column="user_id" property="userId"></id>
        </association>
        <association property="award" javaType="com.hytc.o2o.entity.Award">
            <id column="award_id" property="awardId"></id>
            <result column="shop_id" property="shopId"></result>
        </association>
        <association property="operator" javaType="com.hytc.o2o.entity.PersonInfo">
            <id column="operator" property="userId"></id>
        </association>
    </resultMap>


    <select id="findUserAwardMapList" resultMap="userAndAwardMap">
        SELECT
          user_award_id,
          create_time,
          point,
          used_status,
          user_id,
          award_id,
          operator
        FROM
          tb_user_award_map
        <where>
            <if test="condition.userAndAwardId neq null and condition.userAndAwardId neq ''">
                user_award_id = #{condition.userAndAwardId}
            </if>
            <if test="condition.usedStatus neq null and condition.usedStatus neq ''">
                used_status = #{condition.usedStatus}
            </if>
            <if test="condition.userAndAwardId neq null and condition.userAndAwardId neq ''">
                point = #{condition.point}
            </if>
        </where>
        LIMIT #{start},#{pageSize}
    </select>

    <select id="findUserAwardCount" resultType="java.lang.Integer">
        SELECT
        count(user_award_id)
        FROM
        tb_user_award_map
        <where>
            <if test="condition.userAndAwardId neq null and condition.userAndAwardId neq ''">
                user_award_id = #{condition.userAndAwardId}
            </if>
            <if test="condition.usedStatus neq null and condition.usedStatus neq ''">
                used_status = #{condition.usedStatus}
            </if>
            <if test="condition.userAndAwardId neq null and condition.userAndAwardId neq ''">
                point = #{condition.point}
            </if>
        </where>
    </select>
    
    <select id="findUserAndAwardById" resultMap="userAndAwardMap">
         SELECT
          user_award_id,
          create_time,
          point,
          used_status,
          user_id,
          award_id,
          operator
        FROM
          tb_user_award_map
        WHERE
          user_award_id = #{id}
    </select>

    <insert id="sava">
        INSERT INTO
          tb_user_award_map
        (
          user_id,
          award_id,
          shop_id,
          operator,
          create_time,
          expire_time,
          used_status,
          point
        )VALUES (
          #{condition.user.userId},
          #{condition.award.awardId},
          #{condition.award.shopId},
          #{condition.operator.userId},
          NOW(),
          NOW(),
          #{condition.usedStatus},
          #{condition.point}
        )
    </insert>

    <update id="updateUserAndAward">
        UPDATE
            tb_user_award_map
        SET
            expire_time = NOW()
            <if test="condition.userAndAwardId neq null and condition.userAndAwardId neq ''">
                ,user_award_id = #{condition.userAndAwardId}
            </if>
            <if test="condition.usedStatus neq null and condition.usedStatus neq ''">
                ,used_status = #{condition.usedStatus}
            </if>
            <if test="condition.userAndAwardId neq null and condition.userAndAwardId neq ''">
                ,point = #{condition.point}
            </if>
    </update>

    <delete id="delUserAndAward">
        DELETE  FROM
          tb_user_award_map
        WHERE
          user_award_id = #{id}
    </delete>
</mapper>